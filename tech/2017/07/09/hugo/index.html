<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.25" />


<title>Hugo 博客平台应用笔记 - 平台搭建、功能订制、主题调整、使用心得  - 彭浩 ~ Hao Peng</title>
<meta property="og:title" content="Hugo 博客平台应用笔记 - 彭浩 ~ Hao Peng">



  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">

<link rel="stylesheet" href="/css/custom.css">

<link rel="stylesheet" href="/css/localsearch.css">

<link rel="stylesheet" href="/lib/lightGallery/css/lightgallery.css">

<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script async src="/js/load-typekit.js"></script>



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo.png"
         width="50"
         height="50"
         alt="Hao Peng">
  </a>

  <ul class="nav-links">
    
	
	
    
	

	
    
    <li class=""><a href="/">首页</a></li>
    
    <li class=""><a href="/tech/">归档</a></li>
    
    <li class=""><a href="/tech/categories/">分类</a></li>
    
    <li class=""><a href="/tech/tags/">标签</a></li>
    
    <li class=""><a href="javascript:;" class="popup-trigger"><i class="fa fa-search" aria-hidden="true" title="搜索"></i></a></li>
    
  </ul>
</nav>


<div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>
      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">6375 字</span>
    

    
<h1 class="article-title">Hugo 博客平台应用笔记


<span class="article-subtitle">平台搭建、功能订制、主题调整、使用心得</span>

</h1>



<div class="article-date">
  <span> 彭浩 ·   2017/07/09</span>
  <span class="article-toolbar">
    
    <a href="/tech/index.xml" type="application/rss+xml" target="_blank"><i class="fa fa-rss" aria-hidden="true" title="RSS feed"></i></a>
    
    <a href="https://twitter.com/home?status=Hugo&#43;%E5%8D%9A%E5%AE%A2%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E7%AC%94%E8%AE%B0&#43;%2Ftech%2F2017%2F07%2F09%2Fhugo%2F&#43;via&#43;%40haopeng" target="_blank"><i class="fa fa-twitter" aria-hidden="true" title="Share via Twitter"></i></a>
    <a href="http://service.weibo.com/share/share.php?content=utf-8&amp;title=Hugo&#43;%E5%8D%9A%E5%AE%A2%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E7%AC%94%E8%AE%B0&#43;%40%E5%BD%AD%E6%B5%A9&amp;url=%2Ftech%2F2017%2F07%2F09%2Fhugo%2F" target="_blank"><i class="fa fa-weibo" aria-hidden="true" title="分享到新浪微博"></i></a>
    <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fa fa-cc" aria-hidden="true" title="Attribution-NonCommercial-ShareAlike 4.0 International"></i></a>
    
	
    
    
    
	
    <a href="https://github.com/haopen/Blogdown/edit/master/content/tech/2017-07-09-Hugo.Rmd"><i class="fa fa-pencil-square-o" aria-hidden="true" title="编辑本页"></i></a>
    
    </span>
</div>

<div class="article-taxonomies">
  
  <span class="category-prefix"><i class="fa fa-folder-o"></i></span>
  
  <span class="taxonomy-category"><a href="/categories/4-hugo" title="Hugo">Hugo</a></span>;
  
  
  
  <span class="tag-prefix"><i class="fa fa-tags"></i></span>
  
  <span class="taxonomy-tag"><a href="/tags/4-hugo" title="Hugo">Hugo</a></span>;
  
  <span class="taxonomy-tag"><a href="/tags/4-%E5%8D%9A%E5%AE%A2" title="博客">博客</a></span>;
  
  <span class="taxonomy-tag"><a href="/tags/4-latex" title="LaTeX">LaTeX</a></span>;
  
  <span class="taxonomy-tag"><a href="/tags/4-mathjax" title="Mathjax">Mathjax</a></span>;
  
  <span class="taxonomy-tag"><a href="/tags/4-github" title="GitHub">GitHub</a></span>;
  
  <span class="taxonomy-tag"><a href="/tags/4-r-markdown" title="R Markdown">R Markdown</a></span>;
  
  
</div>


    
    <div class="article-content cn" id="articleContent">
      <div id="TOC">
<ul>
<li><a href="#install"><span class="toc-section-number">1</span> 安装与运行</a><ul>
<li><a href="#rstudio-"><span class="toc-section-number">1.1</span> RStudio 安装</a></li>
<li><a href="#hugo-"><span class="toc-section-number">1.2</span> Hugo 安装</a></li>
<li><a><span class="toc-section-number">1.3</span> 博客搭建</a><ul>
<li><a href="#-1"><span class="toc-section-number">1.3.1</span> 方法 1</a></li>
<li><a href="#-2"><span class="toc-section-number">1.3.2</span> 方法 2</a></li>
<li><a href="#-3"><span class="toc-section-number">1.3.3</span> 方法 3</a></li>
<li><a href="#-4"><span class="toc-section-number">1.3.4</span> 方法 4（推荐）</a></li>
</ul></li>
</ul></li>
<li><a><span class="toc-section-number">2</span> 站点配置与功能订制</a><ul>
<li><a><span class="toc-section-number">2.1</span> 站点配置</a></li>
<li><a><span class="toc-section-number">2.2</span> 功能订制</a></li>
<li><a href="#futureFeatures"><span class="toc-section-number">2.3</span> 待实现</a></li>
</ul></li>
<li><a><span class="toc-section-number">3</span> 主题调整</a><ul>
<li><a><span class="toc-section-number">3.1</span> 页面宽度</a></li>
<li><a><span class="toc-section-number">3.2</span> 字体</a></li>
</ul></li>
<li><a><span class="toc-section-number">4</span> 使用心得</a></li>
<li><a><span class="toc-section-number">5</span> 功能解读</a></li>
</ul>
</div>

<div id="install" class="section level1">
<h1><span class="header-section-number">1</span> 安装与运行</h1>
<div id="rstudio-" class="section level2">
<h2><span class="header-section-number">1.1</span> RStudio 安装</h2>
<p>暂时不能直接用官方网站的正式版安装，而要用 <a href="https://dailies.rstudio.com/" class="uri">https://dailies.rstudio.com/</a> 提供的开发测试版，否则无法直接通过 RStudio 的新建 Project 向导创建一个 Hugo 的博客站点。</p>
</div>
<div id="hugo-" class="section level2">
<h2><span class="header-section-number">1.2</span> Hugo 安装</h2>
<pre><code>C:\Users\Howard\AppData\Roaming\Hugo 这是一个 dos 命令的示例：dir *.txt</code></pre>
<p><a href="https://gohugo.io/">Hugo</a> 基于 <a href="https://golang.org/">Go</a> 语言编写，与 <a href="https://jekyllrb.com/">Jekyll</a> 和 <a href="https://hexo.io/">Hexo</a> 相比，虽然 Hugo 目前<a href="https://themes.gohugo.io/">主题</a>和插件还不如 Hexo 丰富，但它运行速度极快，并且安装非常容易，用户只需要<a href="https://github.com/gohugoio/hugo/releases">下载</a>主程序 <code>Hugo.exe</code> 并复制到指定目录即可<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>：</p>
<pre class="txt"><code>C:\Users\Howard\AppData\Roaming\Hugo</code></pre>
<p>具体使用时可以参考<a href="https://gohugo.io/overview/introduction/">官方文档</a>（<a href="http://www.gohugo.org/">中文</a>）进一步了解如何使用 Hugo，还可以到 GitHub 了解存在的问题以及目前的开发进度，到 <a href="https://discourse.gohugo.io/">Community</a> 与其他用户讨论使用过程中遇到的各种问题。</p>
</div>
<div class="section level2">
<h2><span class="header-section-number">1.3</span> 博客搭建</h2>
<div id="-1" class="section level3">
<h3><span class="header-section-number">1.3.1</span> 方法 1</h3>
<p>首先，切换到放置博客文件的目录，比如 <code>D:\GitHub</code>，接下来右键并选择 <code>GUI Bash Here</code>，之后在弹出的命令对话框中输入如下命令：</p>
<pre class="bash"><code>git clone --recursive https://github.com/yihui/blogdown-yihui-template.git</code></pre>
<p>就可以从谢益辉的 Github 上将 <code>hugo-lithium-theme</code> 所需的文件全部下载到本地的 <code>D:\GitHub\blogdown-yihui-template\</code> 目录之中，这个目录名称可以自行修改，比如修改成 <code>blogdown_Haopeng</code>。</p>
<p>其次，打开 RStudio，输入如下命令：</p>
<pre class="r"><code>setwd(&#39;D:/GitHub/blogdown_Haopeng&#39;)
blogdown::serve_site()</code></pre>
<p>当控制台显示 <code>Serving the directory D:\GitHub\blogdown_Haopeng at http://127.0.0.1:4321</code> 类似的文字时，就可以在浏览器中输入 <code>http://127.0.0.1:4321</code> 进行预览，因为具有 Hugo 实时预览功能，因此对目录中相关文件进行修改后，甚至不需要刷新浏览器就可以看到更新后的结果。</p>
</div>
<div id="-2" class="section level3">
<h3><span class="header-section-number">1.3.2</span> 方法 2</h3>
<p>如果没有安装 git 客户端，也可以跳过上面的两个步骤，直接在 RStudio 中输入如下命令：</p>
<pre class="r"><code>setwd(&#39;D:/GitHub/blogdown_Haopeng&#39;)
blogdown::new_site(theme = &#39;yihui/hugo-lithium-theme&#39;)
blogdown::serve_site()</code></pre>
<p>这样生成的博客站点和上面的非常类似，但细节和相关功能上可能会有比较多的问题。</p>
</div>
<div id="-3" class="section level3">
<h3><span class="header-section-number">1.3.3</span> 方法 3</h3>
<p>先复制一份打包好的 <code>blogdown_Haopeng</code> 目录到指定位置，然后参考方法 1 第二步进行操作。</p>
</div>
<div id="-4" class="section level3">
<h3><span class="header-section-number">1.3.4</span> 方法 4（推荐）</h3>
<p>方法 1 和 方法 3 的思路会遇到一个比较奇怪的事情，在 <a href="https://github.com/rstudio/blogdown/issues/140" class="uri">https://github.com/rstudio/blogdown/issues/140</a> 反映了此问题：就是在 Rmd 中<del><strong>无法</strong></del>成功通过如下的设置来生成文章内的目录，并给每个小标题添加编号，</p>
<pre class="yaml"><code>output:
  blogdown::html_page:
    toc: true
    number_sections: true</code></pre>
<p>根据试验的结果来看，直接在 RStudio 中按 <a href="https://bookdown.org/yihui/blogdown/rstudio-ide.html" class="uri">https://bookdown.org/yihui/blogdown/rstudio-ide.html</a> 给出的说明：</p>
<ol style="list-style-type: decimal">
<li>点击 <code>File -&gt; New Project -&gt; New Directory</code>，然后按照下面两张图的设置进行站点初始化：</li>
</ol>
<div class="figure">
<img src="/images/Tech/Hugo/RStudio/NewProject/1.png" alt="Create a new website project in RStudio." />
<p class="caption">Create a new website project in RStudio.</p>
</div>
<div class="figure">
<img src="/images/Tech/Hugo/RStudio/NewProject/2.png" alt="Create a website project based on blogdown." />
<p class="caption">Create a website project based on blogdown.</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>将 <code>yihui/blogdown-yihui-template.git</code> 下面的 <code>\layouts\*</code> 和 <code>\static\*</code> 复制到 <code>Blogdown</code> 中；</li>
<li>复制 <code>config.yaml</code> 并删除默认的 <code>config.toml</code>；</li>
<li>在 Rmd 文件头中添加上面给出的 <code>output</code> 设置；</li>
<li><del>不复制</del> <code>blogdown-yihui-template\R</code> 中的 <code>build_one.R</code> 和 <code>build.R</code>；</li>
<li>在 RStudio 中运行 <code>blogdown::serve_site()</code>。</li>
</ol>
<p>这样又可以成功得到 Pandoc 风格的 toc 和 编号后的标题。但目前不清楚为什么用方法 1 和方法 3 不能成功，也不确定方法 2 和这里的方法 4 的完整区别（至少方法 4 中的指定 <code>Create project as subdirectory of</code> 是方法 2 默认没有的）。</p>
<blockquote>
<p><strong>注意</strong>：如 <a href="https://bookdown.org/yihui/blogdown/output-format.html" class="uri">https://bookdown.org/yihui/blogdown/output-format.html</a> 最下方指出的，方法 4 可能会导致语法高亮等失效，可以通过 <code>highlight.js</code> 的方法来修正，在实际运行过程中，IE 下在线加载该语法高亮工具的 CSS 文件可能会比较慢，而在 Chrome 下这个过程很迅速。另外，这个页面中说使用 R Markdown 时，公式需要通过 <code>`$...$`</code> 才可以正常工作，但实际上模板已经可以直接用 <code><code>$...</code>$</code> 来完成公式的输入。</p>
</blockquote>
<p><a href="https://support.rbind.io/2017/04/25/yihui-website/" class="uri">https://support.rbind.io/2017/04/25/yihui-website/</a> 是谢益辉对自己网站模板的比较详细的思路介绍，值得多读一下，了解更多的细节。</p>
</div>
</div>
</div>
<div class="section level1">
<h1><span class="header-section-number">2</span> 站点配置与功能订制</h1>
<div class="section level2">
<h2><span class="header-section-number">2.1</span> 站点配置</h2>
<p>站点配置主要在 <code>config.yaml</code> 文件中进行，直接参考谢益辉的 <code>config.yaml</code> 文件进行修改即可，注意目前暂时不添加 <code>googleAnalytics</code> 相关的信息，因此这一部分的取值为空。</p>
<blockquote>
<p><strong>说明</strong>：Hugo 的配置包含两部分，一部分位于主题目录之中，比如 <code>themes\hugo-lithium-theme\</code> 下的 <code>static\</code> 或 <code>layout\</code>，另一部分位于站点根目录之中，比如 <code>\layout\</code> 或 <code>\static\</code>，其中后者的优先级要高于前者。在后续的内容中，涉及到相关目录时，如果没有提及“主题中的”相关字眼，通常指的是站点根目录中的相关目录或文件。</p>
</blockquote>
</div>
<div class="section level2">
<h2><span class="header-section-number">2.2</span> 功能订制</h2>
<p>功能订制主要是在谢益辉已提供功能的基础上进行修正和添加，首先需要从谢益辉的 <code>\static\</code> 和 <code>\layout\</code> 中复制全部文件到博客的根目录中，接下来，</p>
<ul>
<li><strong>logo</strong>：在 <code>\static\images\</code> 中放置已经做好的头像文件，如果觉得不满意，可以在 Photoshop 中参考已经做好的头像文件自行调整；</li>
<li><strong>disqus</strong>：将 <code>\layouts\partials\disqus.html</code> 文件中的：</li>
</ul>
<pre class="javascript"><code>var disqus_js = &#39;//{{ .Site.DisqusShortname }}.disqus.com/embed.js&#39;;</code></pre>
<p>替换成：</p>
<pre class="javascript"><code>var disqus_js = &#39;https://{{ .Site.DisqusShortname }}.disqus.com/embed.js&#39;;</code></pre>
<ul>
<li><strong>OK</strong>：关于异步加载字体功能，将 <code>\static\js\load-typekit.js</code> 文件中的 <code>kitId: 'kwz5xar'</code> 修改成 <code>kitId: 'oqz0fck'</code>，这里的 <code>kitId</code> 需要<a href="https://typekit.com/plans">注册</a>获得<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>；</li>
<li>从 <code>\layouts\partials\head_custom.html</code> 可以看出：
<ul>
<li><strong>OK</strong>：FontAwesome 相关的字体也是异步在线加载的，现在已迁移到本地，否则 Ad block 有可能产生不好的影响，导致图标无法显示；</li>
<li><strong>OK</strong>：只有 <code>cn/</code> 目录下的文章会异步加载思源宋体，已修改，参考 <code>head_custom.html</code>；</li>
<li><strong>OK</strong>：谢益辉设定 2017 年以前的文章会异步加载 <a href="https://github.com/vinta/pangu.js"><code>pangu</code></a> 插件，这里将 <code>{{ if lt (.Date.Year) 2017 }}</code> 修改成 <code>{{ if lt (.Date.Year) 2005 }}</code>，相当于不再加载该插件；</li>
</ul></li>
<li><strong>OK</strong>：时间格式正文页中的时间格式显示比较怪，在没有了解 Hugo 的语法前，将 <code>\layouts\partials\article_meta.html</code> 文件中的 <code>{{ .Date.Format (default &quot;January 2, 2006&quot; .Site.Params.dateFormat ) }}</code> 修改成 <code>{{ .Date.Format &quot;2006/01/02&quot; }}</code>；</li>
<li><strong>OK</strong>：GitHub Edit 在 Windows 上，文件路径中使用 <code>\</code>，而 <code>\layouts\partials\article_meta.html</code> 中没有考虑到这一点，导致生成的链接中包含 <code>%5c</code> 字样，这正是 <code>\</code> 对应的 html 转义码，因此将文件中的<code>{{ $.Scratch.Set &quot;filePath&quot; $.File.Path }}</code> 修改成 <code>{{ $.Scratch.Set &quot;filePath&quot; (replace $.File.Path &quot;\\&quot; &quot;/&quot;) }}</code>，注意不是替换 <code>%5c</code>，而是 <code>\\</code>；</li>
<li><strong>OK</strong>：关于页面标题居中通过修改 <code>\layouts\partials\article_meta.html</code> 将“关于”页面的标题剧中，具体的，需要将如下代码</li>
</ul>
<pre class="html"><code>&lt;h1 class=&quot;article-title&quot;&gt;{{ .Title }}</code></pre>
<p>修改为：</p>
<pre class="html"><code>{{if findRE &quot;-about$&quot; $.File.BaseFileName }}
&lt;h1 class=&quot;article-title&quot; style=&quot;text-align: center;&quot;&gt;{{ .Title }}
{{ else }}
&lt;h1 class=&quot;article-title&quot;&gt;{{ .Title }}
{{ end }}</code></pre>
</div>
<div id="futureFeatures" class="section level2">
<h2><span class="header-section-number">2.3</span> 待实现</h2>
<ol style="list-style-type: decimal">
<li>R Markdown 下面设定超链接在新窗口中打开，Plain Markdown 中在 <code>_config.yaml</code> 的 <code>blackfriday</code> 设置即可；</li>
<li>标签和分类相关的问题：
<ul>
<li>标签和分类中的空格会被自动忽略，怎么禁止；</li>
<li>标签和分类为中文时，Blogdown 对应的当前分类（标签）条目汇总页无法显示，但是 <a href="https://blog.coderzh.com/categories/读书笔记/" class="uri">https://blog.coderzh.com/categories/读书笔记/</a> 是正常工作的，这说明有可能是 blogdown 或者模板的问题；</li>
<li>另一个问题是当前分类（标签）汇总页的标题不能是 <code>.Title</code>，否则取值为 <code>年份</code>，这里由于 <code>tags</code> 和 <code>categories</code> 都位于站点根目录下，因此唯一的可能是获取用户进到本页面之前的前一个页面对应的 section，然后根据该 section 展示一个与 section 有关的标签页或分类页，然而这样做的基础是可以在不同的 section 下面生成各自的 <code>tags</code> 和 <code>categories</code> 页，估计会有比较大的困难；</li>
<li><strong>已解决</strong>：<strong>标签云</strong>功能的实现，默认的分类和标签都是同一类对象，而现在需要将两类对象分离出来，查看 <a href="https://github.com/kakawait/hugo-tranquilpeak-theme" class="uri">https://github.com/kakawait/hugo-tranquilpeak-theme</a> 中 kakawait-tranquilpeak 的主题效果时，发现里面有一个 <code>\layouts\taxonomy</code> 目录，其中包含了 <code>archive.terms.html</code>, <code>category.html</code>, <code>category.terms.html</code>, <code>tag.html</code>, <code>tag.terms.html</code>，再根据 <a href="https://gohugo.io/templates/terms/" class="uri">https://gohugo.io/templates/terms/</a> 的文档说明，显然存档页、分类页、标签页都可以分开定义模板，其中 <code>tag.terms.html</code> 是标签汇总页（标签云），那么 <code>tag.html</code> 就应该是某个标签下的 post 的展示页，暂时不清楚 <code>archive.terms.html</code> 的作用。在 <code>\layouts\taxonomy</code> 中添加了一个自定义的 <code>tag.terms.html</code>，之后就可以生成标签汇总页。具体生成标签汇总页时，发现 <a href="https://www.josephearl.co.uk/tags" class="uri">https://www.josephearl.co.uk/tags</a> 的标签云效果很不错，于是： (1) 到 <a href="https://github.com/josephearl/website" class="uri">https://github.com/josephearl/website</a> 下载了对应的源代码（主题的其它功能可以到 <a href="https://github.com/nodejh/hugo-theme-cactus-plus" class="uri">https://github.com/nodejh/hugo-theme-cactus-plus</a> 查阅），提取其中的 <code>themes\cactus-plus\static\js\js.tags</code> 到自己博客的 <code>\static\js\，(2) 参考这个模板中的</code>\section.html<code>文件的内容，同时参考 &lt;https://github.com/kakawait/hugo-tranquilpeak-theme&gt; 的目录结构，在</code><code>中添加了一个自定义的</code>tag.terms.html<code>，(3) 修改</code>tags.js<code>中的</code>var tagcloudOptions={size:{start:12,end:30,unit:“pt”},color:{start:“#bbbbbb”,end:“#2dbe60”}}<code>，将其中的两个</code>start<code>,</code>end` 修改成现在的取值，用于指定标签云字体的大小和颜色。</li>
<li><a href="https://www.josephearl.co.uk/tags" class="uri">https://www.josephearl.co.uk/tags</a> 是一个非常好的标签云的效果；</li>
</ul></li>
<li>标签：正文中的标签，标签汇总页（<strong>已解决</strong>），单个标签对应文章列表（分页，<strong>待解决</strong>）；</li>
<li>分类：正文中显示所属分类，分类目录页（分页），单个分类中的文章列表（分页）；
<ul>
<li><a href="https://tranquilpeak.kakawait.com/categories/" class="uri">https://tranquilpeak.kakawait.com/categories/</a>：这个分类页面显示了标签，还显示了全部 post，不同分类下的 post，值得参考；</li>
</ul></li>
<li><strong>可解决非 tags 部分</strong>：除了 EN 下外，其它地方的 tags list/paper list 的标题都用中文，这些地方的标题都居中；</li>
<li>能不能每个 section 中包含一个 <code>tags</code> 和 <code>categories</code> 页面？</li>
<li>存档：按年份倒序的存档页（分页），根据 <a href="https://gohugo.io/templates/terms/" class="uri">https://gohugo.io/templates/terms/</a>，可以用 <code>len .Data.Terms</code> 和 <code>len .Data.Pages</code> 得到标签数和页数；</li>
<li>Hexo 中的 <code>&lt;ol&gt;</code> 标记默认可以添加一个 <code>start</code> 属性，但是本主题中还不支持，用 R Markdown 可以通过 Pandoc 的能力来实现；</li>
<li>FontAwesome 相关的字体也是异步在线加载的，可以考虑将来迁移到本地；</li>
<li><strong>可解决</strong>：只有 <code>cn/</code> 目录下的文章会异步加载思源宋体，需要修改；</li>
<li><strong>可解决</strong>：页面摘要：用 <code>&lt;!-- more --&gt;</code> 生成的目录页和存档页不同，这种类型的页面中包含一部分正文内容，并且需要支持分页；</li>
<li><strong>可解决</strong>：<strong>搜索</strong>功能：
<ul>
<li>可以用 <code>lunr.js</code> 或者其增强版 <a href="http://blog.csdn.net/watkinsong/article/details/47168075"><code>elasticlunr.js</code></a> 来实现，其中 <code>lunr.js</code> 的比较好的主题示例可以参考 <a href="https://themes.gohugo.io/docdock/">DocDock</a>；</li>
<li>另一种方案是 Hexo 的 NexT 主题使用的 <a href="https://github.com/algolia/react-instantsearch/"><code>instantsearch.js</code></a>，<a href="https://community.algolia.com/instantsearch.js/v2/getting-started.html" class="uri">https://community.algolia.com/instantsearch.js/v2/getting-started.html</a> 有一个比较详细的使用步骤介绍，<a href="https://codepen.io/Algolia/pen/ZOyoJg" class="uri">https://codepen.io/Algolia/pen/ZOyoJg</a> 是一个非常好的演示例子。</li>
<li><a href="https://www.josephearl.co.uk/" class="uri">https://www.josephearl.co.uk/</a> 的在线搜索感觉非常轻量，也还不错，一些小细节的 CSS 问题还可以参考 <a href="https://www.josephearl.co.uk/post/css-overlay/" class="uri">https://www.josephearl.co.uk/post/css-overlay/</a>。这个博客用的是 <a href="https://github.com/nodejh/hugo-theme-cactus-plus" class="uri">https://github.com/nodejh/hugo-theme-cactus-plus</a>，从 <a href="https://github.com/josephearl/website" class="uri">https://github.com/josephearl/website</a> 下载的源代码中的 <code>\themes\cactus-plus\static\js</code> 目录中可以发现，同时有 <code>search.js</code> 和 <code>lunr.js</code>，因此感觉应该是一个 <code>lunr.js</code> 的包装，不过这个站点的搜索好像只针对标题和标签，虽然快但是没有全文搜索的能力；</li>
<li>Hexo 的 NexT 主题实际上本人现在用的是一种本地搜索的实现方式，<code>themes\next\layout\_third-party\search</code> 中的 <code>localsearch.swig</code> 以及 <code>next\source\css\_common\components\third-party</code> 中的 <code>localsearch.styl</code> 是两个最为重要的文件，还有一个 <code>next\layout\_partials\search</code> 中的 <code>localsearch.swig</code> 可以参考，这是目前最满意的方案，可惜需要用到 <code>db.json</code>，这个文件目前还没有找到好的方案来生成，但感觉上与 Hugo 的 <code>index.xml</code> 文件的生成有关联。</li>
<li><a href="https://discourse.gohugo.io/t/search-index-json-file-for-lunr-js/6286/8">Search Index .json-file for Lunr.js</a>：没看明白；</li>
<li><a href="https://github.com/gohugoio/hugo/issues/144">Save data to “data/pages.json” #144</a>：没有解决方案；</li>
<li><a href="https://github.com/gohugoio/hugo/pull/1853">Add generator for a search index #1853</a>：没有解决方案；</li>
<li>生成全站的 <code>json</code> 文件（<strong>未解决</strong>）：
<ul>
<li><a href="https://bitquabit.com/post/json-feed-with-hugo/" class="uri">https://bitquabit.com/post/json-feed-with-hugo/</a>：已试验不成功；</li>
<li><a href="https://github.com/bep/bepsays.com/commit/1d7bf7fd6e7c637f28a04f93a97ebfed084c27ff" class="uri">https://github.com/bep/bepsays.com/commit/1d7bf7fd6e7c637f28a04f93a97ebfed084c27ff</a>：未试验，但感觉是一个 post 生成一个文件，这个地址来自 <a href="https://discourse.gohugo.io/t/simple-json-site-index-in-hugo/2854">Simple JSON site index in Hugo</a>；</li>
</ul></li>
</ul></li>
<li><strong>可解决</strong>：图片浏览器：<code>fancybox</code>；</li>
<li><strong>OK</strong>：图片保存的路径，在 <code>\static\images\</code> 中保存是比较好的选择，Rmd 文件生成的图像在 <code>static\figures\</code>之中，不需要人工干预；</li>
<li><strong>OK</strong>：文章内目录：<code>\layouts\_default\single.html</code> 显示目前的主题是支持 toc 功能的，需要弄清楚如何开启，目前模板的 <code>single.html</code> 中，可以在 YAML 头中添加 <code>show_toc: true</code> 来开启；</li>
<li><strong>OK</strong>：文章内的子标题编号，由于 Hugo 的 Markdown 引擎 <a href="https://github.com/russross/blackfriday">blackfriday</a> 还不支持 Auto numbering，因此这个功能暂时不好实现，Rmd 提供了接口，但目前运行不成功；</li>
<li><strong>可解决</strong>：pdf、视频文件的显示，参考 <a href="https://gohugo.io/extras/shortcodes/">Shortcodes</a> 可以了解更多关于短代码的说明，里面有 Youtube 的支持，但是感觉这会导致不同的系统不兼容，另外还可以参考主题 <code>Castanet</code> 的实现方法；需要进一步了解自己怎样定义好的短代码；</li>
<li><strong>OK</strong>：图片的标题是用 <code>*...*</code> 还是直接用一个 <code>&lt;p class=&quot;text-align: center&quot;&gt;...&lt;/p&gt;</code>，最终决定定义一个 <code>imgCaption</code> 和 <code>tabCaption</code>，这里使用了 Pandoc 的转换功能，将 Markdown 代码中的可选文本自动转换成 Caption；</li>
<li><strong>OK</strong>：<code>cool\</code> 中的内容的命名规则能不能参考 <code>cn</code> 或 <code>en</code> 目录下的文件，可以参考也可以自己用 <code>slug</code> 直接指定；</li>
<li>如果将幻灯片等和本博客集成到一起，需不需要集成；</li>
<li><strong>OK</strong>：试验添加 <code>Rmd</code> 文件，并在 RStudio 中查看运行效果，原生的 Rmd 格式的 YAML 头和 blogdown 中的并不完全相同；</li>
<li><strong>可解决</strong>：像 <a href="https://github.com/bep/bepsays.com/blob/master/config.toml" class="uri">https://github.com/bep/bepsays.com/blob/master/config.toml</a> 一样，提供不同语言界面的支持，或者像 <a href="https://github.com/kakawait/hugo-tranquilpeak-theme" class="uri">https://github.com/kakawait/hugo-tranquilpeak-theme</a> 中的 <code>hugo-tranquilpeak-theme-master\i18n</code> 那样用不同 YAML 提供语言支持的做法也非常值得参考；</li>
<li>多主题：<a href="https://yulinling.net/" class="uri">https://yulinling.net/</a> 中 blog 部分是卡片列表，而相册部分是另外一种主题，不知道是不是可以在不同的 Section 中用不同的主题，还是压根是两个站点；</li>
<li>如何通过 Hugo 删除一些不想要的 post 在 <code>public\</code> 中的 html 存档；</li>
</ol>
</div>
</div>
<div class="section level1">
<h1><span class="header-section-number">3</span> 主题调整</h1>
<div class="section level2">
<h2><span class="header-section-number">3.1</span> 页面宽度</h2>
<p>在 <code>static/css/fonts/</code> 中修改 <code>custom.css</code>，相关内容参考该文件中的注释。</p>
</div>
<div class="section level2">
<h2><span class="header-section-number">3.2</span> 字体</h2>
<p>在 <code>static/css/fonts/</code> 中修改 <code>fonts.css</code>，调整字体相关的设置为如下内容：</p>
<pre class="css"><code>body {
  font-family: &#39;Alegreya&#39;, &#39;Palatino Linotype&#39;, &#39;Book Antiqua&#39;, Palatino,
    &#39;source-han-serif-sc&#39;, &#39;Source Han Serif SC&#39;, &#39;Source Han Serif CN&#39;,
    &#39;Source Han Serif TC&#39;, &#39;Source Han Serif TW&#39;, &#39;Source Han Serif&#39;, &#39;Songti SC&#39;,
    &#39;仿宋&#39;, &#39;FangSong&#39;, &#39;NSimSun&#39;, &#39;Microsoft YaHei&#39;, serif;
}
blockquote {
  font-family: &#39;Source Sans Pro&#39;, Tahoma, Geneva, &#39;STKaiti&#39;, &#39;KaiTi&#39;, &#39;楷体&#39;, &#39;SimKai&#39;,
    &#39;DFKai-SB&#39;, &#39;NSimSun&#39;, serif;
}
.cn blockquote {
  font-family: &#39;Alegreya&#39;, &#39;Palatino Linotype&#39;, &#39;Book Antiqua&#39;, Palatino, &#39;STKaiti&#39;,
    &#39;KaiTi&#39;, &#39;楷体&#39;, &#39;SimKai&#39;, &#39;DFKai-SB&#39;, &#39;NSimSun&#39;, serif;
}
code {
  font-family: &#39;PT Mono&#39;, &#39;STKaiti&#39;, &#39;KaiTi&#39;, &#39;SimKai&#39;, monospace;
  font-size: 85%;
}
p code, li code {
  font-size: 90%;
}
strong {
  color: #2dbe60;
}</code></pre>
</div>
</div>
<div class="section level1">
<h1><span class="header-section-number">4</span> 使用心得</h1>
<ol style="list-style-type: decimal">
<li>在 yml 头中加入 <code>subtitle: A subtitle</code> 可以为 post 添加一个副标题；</li>
<li>这里是一个 <code>&lt;kbd&gt;...&lt;/kbd&gt;</code> 的例子：<kbd>Ctrl</kbd>；</li>
<li><code>slug: &quot;cn/about&quot;</code> 中的 <code>slug</code> 是 Hugo 特有的一种机制，这里对应的文件实际上只是 <code>\content\cn_about.md</code>，但最终这个文件在 URL 中显示的却是 <code>/cn/about/</code>，所以 Slug 可以同时设定所属的博客子分类以及在 URL 中的文件名称，相当于强制重定向到了某一指定的路径。</li>
<li>要实现 <code><code>$...</code>$</code> 这样的效果，需要使用 <code>&lt;code&gt;</code> 标记，具体参考此处的源代码；</li>
<li>用 R Markdown 时，生成的 toc 如果是全中文的条目，可能链接的下划线无法用 css hack 很好的消除，但给对应的标题一个 <code>{#idName}</code> 时，这个问题自动消失，详细参考本文档上方的目录；</li>
<li>R Markdown 的<a href="https://bookdown.org/yihui/blogdown/content.html#body">说明文档</a>中说在 R Markdown 中不能直接使用 Shortcode，而要用下面的语法<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>：</li>
</ol>
<pre class="markdown"><code>```{r echo=FALSE}
blogdown::shortcode(&#39;tweet&#39;, &#39;852205086956818432&#39;)
```</code></pre>
</div>
<div class="section level1">
<h1><span class="header-section-number">5</span> 功能解读</h1>
<ul>
<li>Hugo 中的相关统计数据，如字数(<code>.WordCount</code>)、估计阅读时间(<code>.ReadingTime</code>)、页数、文章数、分类数等可以参考<a href="https://gohugo.io/templates/variables/">变量列表</a>，特殊功能实现参考<a href="https://gohugo.io/templates/functions/">函数列表</a>；</li>
<li><code>.Site.Params</code> 开头的是站点的<code>全局</code>参数，可以自定义；</li>
<li><code>.Params</code> 开头的是当前文章中的<code>局部</code>参数，在 yml 头中定义，但暂时不清楚是否可以自定义，当然即使可以支持，为了保持和其它系统或 Markdown 的良好兼容，不推荐在文章内用自定义的参数；</li>
<li>下面的代码实现了一个循环：</li>
</ul>
<pre class="html"><code>{{ range .Site.Params.customJS }}
&lt;script async src=&quot;{{ . | relURL }}&quot;&gt;&lt;/script&gt;
{{ end }}</code></pre>
<ul>
<li><code>{{ with FOO }}{{ . }}{{ end }}</code> 是 <code>{{if FOO }}{{ FOO }}{{ end }}</code> 的另一种写法，可以不用写两次 <code>FOO</code>；</li>
<li><code>.Data</code> is dynamic, and its value changes according to the specific list you want to generate. For example, the list page <code>https://xmin.yihui.name/post/</code> only contains pages under <code>content/post/</code>, and <code>https://xmin.yihui.name/note/</code> only contains pages under <code>content/note/</code>；</li>
<li><code>content\</code> 目录下的 <code>_index.md</code> 对应的是存档页，对应 <code>list.html</code>，用于生成全部 post 的存档列表；分类、标签汇总页对应 <code>terms.html</code>，是自动生成的，<code>single.html</code> 对应一篇 post 的生成；分类、汇总还可以通过 <code>list.html</code> 生成各自的存档页，对分类、标签设置不同的模板参考“待解决问题”；</li>
<li><code>_index.md</code> 中有内容时（YAML 除外），本主题将 <code>list.html</code> 转换成一个类似于网站主页说明的 <code>index.html</code>，但这个转换不是用 <code>single.html</code> 的模板，而是 <code>list.html</code> 的 <code>if</code> 分支的模板，没有内容时，填充当前 section 下的全部文章的 list。但不同位置的 <code>_index.md</code> 的管辖范围不同；</li>
<li>模板文件不能用 Markdown，只能用 html 语法格式；</li>
<li>主题中一段比较有参考价值的代码的解释：</li>
</ul>
<pre class="txt"><code>{{ if .File.Path }}

{{ $Rmd := (print .File.BaseFileName &quot;.Rmd&quot;)) }}

{{ if (where (readDir (print &quot;content/&quot; .File.Dir)) &quot;Name&quot; $Rmd) }}
  {{ $.Scratch.Set &quot;FilePath&quot; (print .File.Dir $Rmd) }}
{{ else }}
  {{ $.Scratch.Set &quot;FilePath&quot; .File.Path }}
{{ end }}

{{ with .Site.Params.GithubEdit}}
&lt;a href=&#39;{{ . }}{{ $.Scratch.Get &quot;FilePath&quot; }}&#39;&gt;Edit this page&lt;/a&gt;
{{ end }}

{{ end }}</code></pre>
<p>The basic logic is that for a file, if the same filename with the extension .Rmd exists, we will point the Edit link to the Rmd file. First, we define a variable <code>$Rmd</code> to be the filename with the <code>.Rmd</code> extension. Then we check if it exists. Unfortunately, there is no function in Hugo like <code>file.exists()</code> in R, so we have to use a hack: list all files under the directory and see if the Rmd file is in the list. <code>$.Scratch</code> is the way to dynamically store and obtain variables in Hugo templates. Most variables in Hugo are read-only, and you have to use <code>$.Scratch</code> when you want to modify a variable. We set a variable FilePath in <code>$.Scratch</code>, whose value is the full path to the Rmd file when the Rmd file exists, and the path to the Markdown source file otherwise. Finally we concatenate a custom option GithubEdit in <code>config.toml</code> with the file path to complete the Edit link <code>&lt;a&gt;</code>. Here is an example of the option in <code>config.toml</code>:</p>
<ul>
<li><code>.Data.Terms</code> 解读：<code>.Data.Terms</code> stores all terms under a taxonomy, e.g., all category names. The variable <code>$key</code> denotes the term and <code>$value</code> denotes the list of pages associated with this term. The link of the term is passed to the Hugo function relURL via a pipe <code>|</code> to make it relative, <code>$</code> is required because we are inside a loop, and need to access variables from the outside scope. 注意 <code>$value</code> 中是全部文章对象</li>
</ul>
<pre class="html"><code>&lt;ul class=&quot;terms&quot;&gt;
  {{ range $key, $value := .Data.Terms }}
  &lt;li&gt;
    &lt;a href=&#39;{{ (print &quot;/&quot; $.Data.Plural &quot;/&quot; $key) | relURL }}&#39;&gt;
      {{ $key }}
    &lt;/a&gt;
    ({{ len $value }})
  &lt;/li&gt;
  {{ end }}
&lt;/ul&gt;</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>这个目录是本人电脑上的目录，可自行根据实际情况修改。<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>必需通过 VPN 方式才能注册，无法用 Chrome 带的翻墙功能注册。<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>这段代码的插入需要用比较特殊的语法，与传统的 R Markdow 中使用 backtick 的方法还不相同，具体参考源文件。<a href="#fnref3">↩</a></p></li>
</ol>
</div>

    </div>
    

<nav id="article-nav">
    
    <a href="/tech/2017/07/06/python-web-server/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> 用 Python 搭建一个简单的 Web 服务器</div>
    </a>
    

    
    <a href="/tech/2017/07/08/hugo-template-priority/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title">Hugo 模板优先级解读 <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></div>
    </a>
    
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/tech\/2017\/07\/06\/python-web-server\/';
    
  } else if (e.which == 39) {  
    
    url = '\/tech\/2017\/07\/08\/hugo-template-priority\/';
    
  }
  if (url) window.location = url;
});
</script>



  </article>

  
<section id="comments">
  <div id="disqus_thread"></div>
  <script src="/js/disqusloader.min.js"></script>
  <script>
  var disqus_config = function () {
  
    this.page.url = "https:\/\/haopen.github.io\/" + location.pathname;
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = 'https://haopeng.disqus.com/embed.js';
    
    if (location.hash.match(/^#comment/)) {
      var d = document, s = d.createElement('script');
      s.src = disqus_js; s.async = true;
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    } else {
      disqusLoader('#disqus_thread', {
        scriptUrl: disqus_js, laziness: 0, disqusConfig: disqus_config
      });
    }
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



</main>

      <footer class="footer">
        <ul class="footer-links">
          
          
          <li><a href="https://github.com/haopen"><i class="fa fa-github" aria-hidden="true" title="Github"></i><span class="sr-only">Github</span></a></li>
          <li><a href="https://twitter.com/haopeng"><i class="fa fa-twitter" aria-hidden="true" title="Twitter"></i><span class="sr-only">Twitter</span></a></li>
          <li><a href="http://weibo.com/seplost"><i class="fa fa-weibo" aria-hidden="true" title="新浪微博"></i><span class="sr-only">新浪微博</span></a></li>
          
          <li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fa fa-cc" aria-hidden="true" title="Attribution-NonCommercial-ShareAlike 4.0 International"></i><span class="sr-only">Attribution-NonCommercial-ShareAlike 4.0 International</span></a></li>
          <li><a href="/"><i class="fa fa-copyright" aria-hidden="true" title="Copyright"></i> 2005 - 2017</a></li>
        </ul>
      </footer>
    </div>

	<div id="images-container"></div>

    <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="/lib/jquery/jquery.mousewheel.min.js"></script>
	<script type="text/javascript" src="/lib/lightGallery/js/lightgallery.min.js"></script>
	<script type="text/javascript" src="/lib/lightGallery/js/lg-thumbnail.min.js"></script>
	<script type="text/javascript" src="/lib/lightGallery/js/lg-fullscreen.min.js"></script>
	<script type="text/javascript" src="/lib/lightGallery/js/lg-zoom.min.js"></script>
	<script type="text/javascript" src="/js/lgGallery_Prepare.js"></script>
    
    <script async src="/js/center-img.js"></script>
    
    <script async src="/js/right-quote.js"></script>
    
    <script async src="/js/no-highlight.js"></script>
    
    <script async src="/js/fix-footnote.js"></script>
    
    <script async src="/js/local-search.js"></script>
    
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/tex.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/matlab.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
	TeX: {equationNumbers: {autoNumber: ["AMS"], useLabelIds: true}},
	"HTML-CSS": {linebreaks: {automatic: true}},
	SVG: {linebreaks: {automatic: true}}
});
</script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

